dlmErros(filtro)
beta
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
mod <- dlmModPoly(1) + dlmModSeas(12)
mod$m0 <- c(dnottem[1],beta)
mod <- modFim(dnottem, mod)
mod <- dlmModPoly(1) + dlmModSeas(12)
mod$m0 <- c(dnottem[1],beta)
mod <- modFim(dnottem, mod)
mod <- dlmModPoly(1) + dlmModSeas(12)
mod$m0 <- c(dnottem[1],beta[-12])
mod <- modFim(dnottem, mod)
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
acf(erro)
acf(erro[1:12])
acf(erro[-(1:12)])
dlmErros(filtro,h=13)
dlmErros(filtro,h=24)
acf(erro[-(1:24)])
filtro$m
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
ciclo <- as.factor(cycle(dnottem))
beta <- coefficients( lm( dnottem ~ciclo -1))
mod$m0 <- beta[-12]
ciclo <- as.factor(cycle(dnottem))
beta <- coefficients( lm( dnottem ~ciclo -1))
mod$m0 <- beta[-12]
mod <- modFim(dnottem, mod)
mod <- dlmModSeas(12)
ciclo <- as.factor(cycle(dnottem))
beta <- coefficients( lm( dnottem ~ciclo -1))
mod$m0 <- beta[-12]
mod <- modFim(dnottem, mod)
ciclo <- as.factor(cycle(dnottem))
beta <- coefficients( lm( dnottem ~ciclo -1))
mod$m0 <- c(beta[12],beta[1:10])
mod <- modFim(dnottem, mod)
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
?dlmModSeas
filtro$m
filtro[,1]
filtro$mod[,1]
filtro$m[,1]
ts.plot(filtro$m[,1])
lines(dnottem)
ts.plot(filtro$m[,1], lwd = 2)
lines(dnottem, col = 'red')
dnottem
dnottem <- ldeaths - loess( ldeaths ~ 1:length(ldeaths))$fit
loess( ldeaths ~ 1:length(ldeaths))
tempo <- 1:length(nottem)
loess( nottem ~ tempo)
loess( nottem ~ tempo)$fit
dnottem <- ldeaths - loess( nottem ~ tempo)$fit
tempo <- 1:length(nottem)
dnottem <- ldeaths - loess( nottem ~ tempo)$fit
tempo <- 1:length(nottem)
dnottem <- ldeaths - loess( nottem ~ tempo)$fit
tempo <- 1:length(nottem)
dnottem <- nottem - loess( nottem ~ tempo)$fit
ts.plot(dnottem)
abline(h=0,lty =2)
mod <- dlmModSeas(12)
ciclo <- as.factor(cycle(dnottem))
beta <- coefficients( lm( dnottem ~ ciclo -1))
mod$m0 <- c(beta[12],beta[1:10])
mod <- modFim(dnottem, mod)
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
beta
filtro$m0[,1]
filtro$m[,1]
ts.plot(erro[-(1:24)])
ts.plot(erro[-(1:24)])
acf(erro[-(1:24)])
mod$m0 <- rep(dnottem[1])
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro[-(1:24)])
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
dlmErros(filtroerro <- dnottem - filtro$f
ts.plot(erro[-(1:24)])
erro <- dnottem - filtro$f
ts.plot(erro[-(1:24)])
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro)
erro <- dnottem - filtro$f
ts.plot(erro[-(1:24)])
abline(h=0, lty = 2)
acf(erro)
dlmErros(filtro,h=13)
mod$m0 <- rep(0,11)
mod <- modFim(dnottem, mod)
mod <- dlmModSeas(12)
mod$m0 <- rep(0,11)
mod <- modFim(dnottem, mod)
filtro <- dlmFilter(dnottem, mod)
erro <- dnottem - filtro$f
ts.plot(erro)
acf(erro)
acf(erro[-(1:24)])
acf(erro)
acf(erro[-(1:24)])
pacf(erro[-(1:24)])
pacf(erro)
dnottem
previsao12 <- dlmForecast(filtro,12)
previsao12$f
ts.plot(dnottem,xlim=c(1920,1942), ylim=c(-15,15))
lines( window(filtro$f,start=c(1920,12)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1940,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1940,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 12 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
ts.plot(dnottem,xlim=c(1920,1942), ylim=c(-15,15))
lines( window(filtro$f,start=c(1920,12)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1940,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1940,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 12 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao24 <- dlmForecast(filtro,24)
previsao24$f
ts.plot(dnottem,xlim=c(1920,1942), ylim=c(-15,15))
lines( window(filtro$f,start=c(1920,12)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao24$f
media_prev <- ts(media_prev, start = c(1940,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao24$Q))
desv_prev <- ts(desv_prev, start = c(1940,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
ts.plot(dnottem,xlim=c(1920,1942), ylim=c(-20,15))
lines( window(filtro$f,start=c(1920,12)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao24$f
media_prev <- ts(media_prev, start = c(1940,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao24$Q))
desv_prev <- ts(desv_prev, start = c(1940,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
suave <- dlmSmooth(filtro)
dim(suave$s)
nivel_medio <- suave$s[,1]
sd_nivel <- sd[,1]
ts.plot(dnottem)
lines(nivel_medio, lwd = 2, col = 'seagreen')
# intervalor de credibilidade (95%) para o nível
lines(nivel_medio - 1.96*sd_nivel, lwd = 2, col = 'seagreen', lty= 2)
lines(nivel_medio + 1.96*sd_nivel, lwd = 2, col = 'seagreen', lty=2)
nivel_medio <- suave$s[,1]
sd_nivel <- sd[,1]
sd_nivel
sd
previsao12$f
previsao12$Q
mod$V
mod$W
suave$s[,2]
dnottem = nottem - mena(dnottem)
dnottem = nottem - mean(dnottem)
ts.plot(dnottem)
require(dlm)
?dlmModTrig
knitr::opts_chunk$set(echo = TRUE)
mod <- dlmModTrig(12, 1)
mod <- modFim( dnottem, mod)
filtro <- dlmFilter(dnottem,mod)
erros <- dnottem - filtro$f
ts.plot(erros)
acf(erros)
Iw <- function(y,w){
# matriz de planetamento
n <- length(y)
t <- 1:n
x <- cbind(cos(2*pi*w*t), sin(2*pi*w*t))
# coeficientes do modelo linear
beta <- coefficients(lm(y ~x-1))
# amplitude
A <- sqrt(sum(beta^2))
# Iw
.5*n*A^2
}
periodograma <- function(y){
# gráfico
n <- length(y)
w_detec <- ( 1 : floor(  (n-1)/ 2) ) / n
I_w <- sapply( w_detec, function(w) Iw(y , w) )
plot( 1 / w_detec , I_w, xlab = 'Período', ylab =     expression(I(w)), type = 'h' , lwd = 2)
# encontrando o periodo
fund <-  w_detec[ which( I_w == max(I_w))]
cat('Período: ',1/fund,'\n')
}
periodograma(erro)
periodograma(erros)
erros <- dnottem - filtro$f
ts.plot(erros)
acf(erros)
periodograma(erros)
periodograma(erros)
knitr::opts_chunk$set(echo = TRUE)
library(dlm)
Iw <- function(y,w){
# matriz de planetamento
n <- length(y)
t <- 1:n
x <- cbind(cos(2*pi*w*t), sin(2*pi*w*t))
# coeficientes do modelo linear
beta <- coefficients(lm(y ~x-1))
# amplitude
A <- sqrt(sum(beta^2))
# Iw
.5*n*A^2
}
periodograma <- function(y){
# gráfico
n <- length(y)
w_detec <- ( 1 : floor(  (n-1)/ 2) ) / n
I_w <- sapply( w_detec, function(w) Iw(y , w) )
plot( 1 / w_detec , I_w, xlab = 'Período', ylab =     expression(I(w)), type = 'h' , lwd = 2)
# encontrando o periodo
fund <-  w_detec[ which( I_w == max(I_w))]
cat('Período: ',1/fund,'\n')
}
knitr::opts_chunk$set(echo = TRUE)
library(dlm)
modFim <- function(y,mod){
ffbs <- dlmGibbsDIG(y, mod = mod, n.sample = 5000,
a.y=1,b.y=100,a.theta=1,b.theta=100,
save.states = FALSE, thin = 0)
v_sim  <- sample(ffbs$dV[-(1:2500)],2500,T)
q <- dim(ffbs$dW)[2]
w_sim <- NULL
for(j in 1:q){
w_sim <- c(w_sim, mean(sample(ffbs$dW[,j][-(1:2500)],2500,T)))
}
# declarando as variâncias na quádrupla
mod$V <- mean(v_sim)
mod$W <- diag( w_sim)
return(mod)
}
Iw <- function(y,w){
# matriz de planetamento
n <- length(y)
t <- 1:n
x <- cbind(cos(2*pi*w*t), sin(2*pi*w*t))
# coeficientes do modelo linear
beta <- coefficients(lm(y ~x-1))
# amplitude
A <- sqrt(sum(beta^2))
# Iw
.5*n*A^2
}
periodograma <- function(y){
# gráfico
n <- length(y)
w_detec <- ( 1 : floor(  (n-1)/ 2) ) / n
I_w <- sapply( w_detec, function(w) Iw(y , w) )
plot( 1 / w_detec , I_w, xlab = 'Período', ylab =     expression(I(w)), type = 'h' , lwd = 2)
# encontrando o periodo
fund <-  w_detec[ which( I_w == max(I_w))]
cat('Período: ',1/fund,'\n')
}
tempo <- 1:length(nottem)
dnottem <- nottem - loess( nottem ~ tempo)$fit
erros <- dnottem - filtro$f
ts.plot(erros)
acf(erros)
suave$s[,1:2]
cbind(1:4,5:8)
cbind(1:4,5:8)^2
A1 <- sqrt( suave$s[,1]^2 + suave$s[,2]^2 )
A2 <- sqrt( suave$s[,3]^2 + suave$s[,4]^2 )
plot.ts( cbind(A1, A2), lwd = 2)
mod <- dlmModPoly(2) + dlmModSeas(12)
mod <- modFim(ldeaths, mod)
filtro <- dlmFilter(ldeaths, mod)
erro <- filtro$f
ts.plot(erro)
acf(erro)
mod <- dlmModPoly(2) + dlmModSeas(12)
mod$m0[1] <- ldeaths[1]
mod <- modFim(ldeaths, mod)
filtro <- dlmFilter(ldeaths, mod)
erro <- ldeaths - filtro$f
ts.plot(erro)
acf(erro)
pacf(erro)
?dlmModARMA
erro
ldeaths
min(lde)
min(ldeaths)
max(ldeaths)
prev12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1979), ylim=c(1000,4000))
lines( window(filtro$f,start=c(1980,1)), lty=2,lwd = 2)
prev12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1979), ylim=c(1000,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
prev12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(1000,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(1000,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(600,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(0,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(-200,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
previsao12 <- dlmForecast(filtro, 12)
ts.plot(ldeaths,xlim=c(1974,1981), ylim=c(-400,4000))
lines( window(filtro$f,start=c(1974,1)), lty=2,lwd = 2)
# medidas para o intervalo de previsão
media_prev <- previsao12$f
media_prev <- ts(media_prev, start = c(1980,1), frequency = 12)
desv_prev <- sqrt( unlist( previsao12$Q))
desv_prev <- ts(desv_prev, start = c(1980,1), frequency = 12)
# intervalo de 90% para as previsões
lines(media_prev, lwd = 2, col ='blue')
lines(media_prev -1.64*desv_prev, lwd = 2, col ='blue')
lines(media_prev+1.64*desv_prev, lwd = 2, col ='blue')
# legenda
legend('bottomleft',c('Série observada','Previsão 1 passo à frente', 'Previsão de 24 meses'), lty=c(1,2,1), col =c(1,1,'blue'), bty = 'n')
suave <- dlmSmooth(filtro)
sd <- sdSmooth(suave)
Nível <- suave$s[,1]
`Inc. tendência` <- suave$s[,2]
`Fat. Sazonais` <- sauve$s[,3]
suave <- dlmSmooth(filtro)
sd <- sdSmooth(suave)
Nível <- suave$s[,1]
`Inc. tendência` <- suave$s[,2]
`Fat. Sazonais` <- suave$s[,3]
plot.ts(cbind(Nível, `Inc. tendência`,`Fat. Sazonais`))
suave <- dlmSmooth(filtro)
sd <- sdSmooth(suave)
Nível <- suave$s[,1]
`Inc. tend` <- suave$s[,2]
`Fat. Saz` <- suave$s[,3]
plot.ts(cbind(Nível, `Inc. tend`,`Fat. Saz`), main = 'Componentes do sinal')
gas
x = read.table('clipboard', dec=',')
x
ts.plot(x)
acf(x)
hist(x)
hist(x[,1])
acf(x)
acf(x,lag = 50)
periodograma(x)
periodograma(x[,1])
x = read.table('clipboard', dec=',')
x = read.table('clipboard')
x
ts.plot(x)
acf(x)
acf(x, lag =100)
tempo <- 1:nrow(x)
tend = loess(x ~tempo)$fit
tend = loess(x[,1] ~tempo)$fit
tend
x-tend
ts.plot(x-tend)
acf(x-tend)
x=read.table('clipboard')
ts.plot(x)
acf(x)
ts.plot(x)
periodograma(x)
periodograma(x[,1])
107.5/12
107.5/12
tempo <- 1:nrow(x)
tend = loess(x[,1] ~tempo)$fit
ts.plot(x-tend)
acf(x-tend)
acf(x-tend,lag = 40)
periodograma(x-tend)
periodograma(x[,1-tend)
periodograma(x[,1]-tend)
71/12
71/12
72/12
y=ts(x[,1]-tend, frequency=72)
monthplot(72)
y
monthplot(y)
